<div class="projects-header">
  <h2 id="projects-heading">Projects</h2>
  <span class="project-count" *ngIf="projects.length > 0" role="status">
    {{projects.length}} project{{projects.length !== 1 ? 's' : ''}}
  </span>
</div>

<div class="create-form">
  <h3>Create New Project</h3>
  <form (ngSubmit)="create()" role="form" aria-label="Create new project">
    <div class="form-row">
      <div class="form-group">
        <label for="project-name">Project Name</label>
        <input id="project-name" 
               [(ngModel)]="name" 
               name="name" 
               placeholder="Enter project name" 
               required
               aria-required="true"
               [attr.aria-invalid]="error ? 'true' : null"
               [attr.aria-describedby]="error ? 'project-error' : null">
      </div>
      <div class="form-group">
        <label for="project-desc">Description <span class="optional-hint">(optional)</span></label>
        <input id="project-desc" 
               [(ngModel)]="description" 
               name="description" 
               placeholder="Brief description of the project">
      </div>
      <button type="submit" 
              class="btn-primary"
              [disabled]="busy || !name.trim()"
              [attr.aria-busy]="busy"
              aria-label="Create new project">
        {{busy ? 'Creating...' : 'Create Project'}}
      </button>
    </div>
  </form>
  <div id="project-error" 
       class="small" 
       *ngIf="error" 
       role="alert" 
       aria-live="assertive" 
       style="color:#dc2626; margin-top: 0.75rem; font-weight: 500;">
    {{error}}
  </div>
</div>

<ul class="card-list" 
    role="list" 
    aria-labelledby="projects-heading"
    (keydown)="onListKeydown($event)"
    *ngIf="projects.length > 0">
  <li *ngFor="let p of projects; let i = index" 
      class="project-card" 
      role="listitem"
      [attr.tabindex]="i === 0 ? 0 : -1"
      [attr.aria-label]="'Project: ' + p.name + (p.description ? ', ' + p.description : '')"
      #projectCard>
    <div class="card-header">
      <div class="card-icon" aria-hidden="true">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
      </div>
      <h3 class="card-title" [id]="'project-title-' + p.id">{{p.name}}</h3>
      <p class="card-desc" [class.empty]="!p.description">
        {{p.description || 'No description provided'}}
      </p>
    </div>
    <div class="card-body" role="group" [attr.aria-label]="'Actions for project ' + p.name">
      <button class="btn-action btn-work-items"
              (click)="openWorkItems(p.id)" 
              [attr.aria-describedby]="'project-title-' + p.id"
              aria-label="View work items">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
        </svg>
        Work Items
      </button>
      <button class="btn-action btn-tasks"
              (click)="openTasks(p.id)" 
              [attr.aria-describedby]="'project-title-' + p.id"
              aria-label="View tasks">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"></path>
          <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
        </svg>
        Tasks
      </button>
      <button class="btn-action btn-delete"
              (click)="remove(p.id)" 
              [attr.aria-describedby]="'project-title-' + p.id"
              aria-label="Delete project">
        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
        </svg>
        Delete
      </button>
    </div>
  </li>
</ul>

<div class="empty-state" *ngIf="projects.length === 0" role="status" aria-live="polite">
  <div class="icon" aria-hidden="true">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
    </svg>
  </div>
  <p>No projects yet. Create your first project using the form above.</p>
</div>
